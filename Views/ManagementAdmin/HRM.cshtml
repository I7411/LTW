
@{
    ViewBag.Title = "HRM";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="~/wwwroot/css/ReaderManagement.css" />
    <link rel="stylesheet" href="~/wwwroot/css/MainPage_Admin.css" />
    <link rel="stylesheet" href="~/wwwroot/css/AccountManagement.css">
    <title>Human Resource Management</title>
    <link rel="icon" type="image/png" href="~/wwwroot/Images/logoCongThuong.png" />
    <style>
        tr td:first-child {
            width: 150px;
        }

        tr {
            border: solid 1px;
        }

        #add table {
            background-color: lightgray;
            border: none
        }

        #add {
            padding: 10px;
            border: solid 1px black;
        }

            #add td {
                height: 30px;
                ;
            }

        .navigation span {
            color: red;
            ;
            font-size: 25px;
            text-align: center;
        }

        .navigation {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #add h3 {
            font-size: 30px;
            font-family: Arial, Helvetica, sans-serif;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="imgTitle"><img src="~/wwwroot/Images/Logo.png" alt="" /></div>
            <div class="titleHeader">
                <strong>
                    <img src="~/wwwroot/Images/book.png" alt="" />HỌC HẾT SỨC - CHƠI
                    HẾTMÌNH
                </strong>
                <div class="Search"> <input type="text" name="Search" placeholder="Nhập thông tin cần tìm!"> <button id="Search">Tìm</button></div>
            </div>
        </div>
        <div style="height: 50px;" class="navigation">
            <span>Quản lý nhân viên</span>
        </div>
    </header>
    <div class="Info">
        <form>
            <table>
                <tr>
                    <td>Mã nhân viên:</td>
                    <td colspan="2"><input type="text" name="ma" id="ma"></td>
                    <td>Địa chỉ:</td>
                    <td colspan="2"><input type="text" name="dc" id="dc"></td>
                </tr>

                <tr>
                    <td>Họ tên:</td>
                    <td colspan="2"><input type="text" name="ten" id="ten"></td>
                    <td>Số điện thoại:</td>
                    <td colspan="2"><input type="text" name=sdt id="sdt"></td>
                </tr>
                <tr>
                    <td>Ngày sinh:</td>
                    <td colspan="2"><input type="date" name="date" id="date"></td>
                </tr>
                <tr>
                    <td>Vai trò:</td>
                    <td colspan="2"><input type="text" name="vaitro" id="vaitro"></td>

                </tr>
            </table>
            <div class="btn"><button type="button" id="btnAdd">Thêm</button><button type="button" id="btnDelete">Xóa</button><button type="button" id="btnUpdate">Cập nhật</button><button type="button" onclick="location.href = '@Url.Action("AdminHome","Home")'">Thoát</button></div>
        </form>
    </div>
    <div class="Infotable">
        <div class="title" id="title"><h2>Danh sách nhân viên</h2></div>
        <table>
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Mã nhân viên</th>
                    <th>Họ tên</th>
                    <th>Ngày sinh</th>
                    <th>Địa chỉ</th>
                    <th>Vai trò</th>
                    <th>Số điện thoại</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var Database = new Library_Management.Models.QUANLYTHUVIENEntities();
                    var d = Database.NHANVIENs;
                    int stt = 1;
                    foreach (var item in d)
                    {
                        <tr>
                            <td>@stt</td>
                            <td>@item.MANV</td>
                            <td>@item.TENNV</td>
                            <td>@(item.NGSINH.HasValue ? item.NGSINH.Value.ToString("yyyy/MM/dd") : "")</td>
                            <td>@item.DIACHI</td>
                            <td>@item.VAITRO</td>
                            <td>@item.SODIENTHOAI</td>
                        </tr>
                        stt++;
                    }

                }
            </tbody>
        </table>
    </div>
    <script src="@Url.Content("~/wwwroot/JS/jquery-3.3.1.min.js")"></script>

    <script src="~/wwwroot/JS/AccountManagement.js">
    </script>
    <script>
$(".Infotable tbody tr").on("click", function () {
    var ma = $(this).find("td:eq(1)").text().trim();
    var ten = $(this).find("td:eq(2)").text().trim();
    var date = $(this).find("td:eq(3)").text().trim();
    var dc = $(this).find("td:eq(4)").text().trim();
    var vaitro = $(this).find("td:eq(5)").text().trim();
    var sdt = $(this).find("td:eq(6)").text().trim();

    $("#ma").val(ma);
    $("#dc").val(dc);
    $("#ten").val(ten);
    $("#sdt").val(sdt);
    $("#date").val(date);
    $("#vaitro").val(vaitro);
});

function formatDateForInput(dateStr) {
    if (!dateStr) return "";
    var parts = dateStr.split('/');
    if (parts.length !== 3) return "";
    return parts[2] + '-' + parts[1].padStart(2, '0') + '-' + parts[0].padStart(2, '0');
}

function getFormData() {
    return {
        MANV: $("#ma").val(),
        TENNV: $("#ten").val(),
        NGSINH: $("#date").val(),
        DIACHI: $("#dc").val(),
        VAITRO: $("#vaitro").val(),
        SODIENTHOAI: $("#sdt").val()
    };
}

$("#btnAdd").on("click", function () {
    var data = getFormData();
    $.post('@Url.Action("ThemNhanVien", "ManagementAdmin")', data, function (res) {
        alert(res.message);
        location.reload();
    });
});

$("#btnDelete").on("click", function () {
    var ma = $("#ma").val();
    if (!ma) {
        alert("Vui lòng chọn nhân viên để xóa");
        return;
    }

    if (confirm("Bạn có chắc muốn xóa nhân viên này?")) {
        $.post('@Url.Action("XoaNhanVien", "ManagementAdmin")', { ma: ma }, function (res) {
            alert(res.message);
            location.reload();
        });
    }
});

$("#btnUpdate").on("click", function () {
    var data = getFormData();
    $.post('@Url.Action("CapNhatNhanVien", "ManagementAdmin")', data, function (res) {
        alert(res.message);
        location.reload();
    });
});    </script>
</body>
</html>

