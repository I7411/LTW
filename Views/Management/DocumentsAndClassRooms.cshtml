@model Library_Management.Models.DATPHONG
@{
    ViewBag.Title = "DocumentsAndClassRooms";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="~/wwwroot/css/ReaderManagement.css" />
    <link rel="stylesheet" href="~/wwwroot/css/MainPage_Admin.css" />
    <link rel="stylesheet" href="~/wwwroot/css/DocumentsAndClassRooms.css">
    <title>Documents and ClassRooms Management</title>
    <link rel="icon" type="image/png" href="~/wwwroot/Images/logoCongThuong.png" />
    <style>
        .tableInfo table {
            width: 100%;
        }

        table td {
            text-align: center;
        }

        table tbody td button {
            background-color: gray;
        }

            table tbody td button:hover {
                background-color: lightblue;
            }

        #requestClassrooms input {
            background-color: lightgray;
            color: #003087;
            font-size: 15px;
            border: none;
        }

        .InfoClassrooms tr:hover {
            background-color: lightskyblue;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="imgTitle"><img src="~/wwwroot/Images/Logo.png" alt="" /></div>
            <div class="titleHeader">
                <strong>
                    <img src="~/wwwroot/Images/book.png" alt="" />HỌC HẾT SỨC - CHƠI
                    HẾTMÌNH
                </strong>
            </div>
        </div>
        <div style="height: 50px;" class="navigation"></div>
    </header>
    @if (TempData["Notice"] != null)
    {
        <div id="Notice" style="display: flex; align-items: center; justify-content: center;
                            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
                            padding: 10px 20px; color: white; background-color: red;
                            height: auto; max-width: 90%; z-index: 10000000000;
                            border-radius: 5px; font-weight: bold;">
            @TempData["Notice"]
        </div>
    }
    <div id="requestClassrooms">
        <h2>THÔNG TIN PHIẾU YÊU CẦU</h2>
        @using (Html.BeginForm("Accept", "Management", FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            <table>
                <tr>
                    <td colspan="1">Mã phiếu yêu cầu</td>
                    <td colspan="5">
                        <input type="text" name="maphong" readonly />
                    </td>
                </tr>
                <tr>
                    <td colspan="1">Yêu cầu</td>
                    <td colspan="5"><input type="text" name="yeucau" disabled /></td>
                </tr>
                <tr>
                    <td colspan="1">Mã độc giả</td>
                    <td colspan="2"><input type="text" name="madocgia" disabled /></td>
                    <td colspan="1" style="border-right:none;">Mã phòng</td>
                    <td colspan="2" style="border-left: none;">
                        <input type="text" name="maphong" disabled />
                    </td>
                </tr>
                <tr>
                    <td colspan="1">Tên độc giả</td>
                    <td colspan="2"><input type="text" name="tendocgia" disabled /></td>
                    <td colspan="1" style="border-right:none;">Tên phòng</td>
                    <td colspan="2" style="border-left: none;"><input type="text" name="tenphong" disabled /></td>
                </tr>
                <tr>
                    <td colspan="1">Vai trò</td>
                    <td colspan="2"><input type="text" name="vaitro" disabled /></td>
                    <td colspan="1" style="border-right:none;">Vị trí phòng</td>
                    <td colspan="2" style="border-left: none;"><input type="text" name="vitri" disabled /></td>
                </tr>
                <tr>
                    <td colspan="1">Khoa</td>
                    <td colspan="2"><input type="text" name="khoa" disabled /></td>
                    <td colspan="1" style="border-right:none;">Trạng thái phòng</td>
                    <td colspan="2" style="border-left: none;"><input type="text" name="trangthaiphong" disabled /></td>
                </tr>
                <tr>
                    <td colspan="1">Lớp</td>
                    <td colspan="5"><input type="text" name="lop" disabled /></td>
                </tr>
                <tr>
                    <td colspan="1">Số lần gia hạn</td>
                    <td colspan="5"><input type="text" name="solan" disabled /></td>
                </tr>
                <tr>
                    <td colspan="1">Thời gian mượn phòng</td>
                    <td colspan="5"><input type="text" name="tgmuon" disabled /></td>
                </tr>
                <tr>
                    <td colspan="1">Thời gian trả phòng</td>
                    <td colspan="5"><input type="text" name="tgtra" disabled /></td>
                </tr>
            </table>
            <div class="response"><button type="button" onclick="closeForm()">Từ chối</button><button type="submit">Đồng ý</button></div>
        }
    </div>
    <div class="containerManagement">
        <h3>MƯỢN - TRẢ - GIA HẠN</h3>
        <div class="nav">
            <div class="large">
                <div class="small">
                    <button type="submit" onclick="location.href = '@Url.Action("LibrarianHome","Home")'"><img src="~/wwwroot/Images/EXIST.png"><span>Thoát</span></button>
                </div>
            </div>
        </div>
    </div>
    <div class="content">
        <div class="function">
            <div class="change">
                <button onclick="showTableClassrooms()" id="clas">Phòng học</button>
            </div>
            <div class="Search"><input type="text" id="Search" name="Search" placeholder="Nhập thông tin cần tìm!"><button>Tìm</button></div>
        </div>
        <div class="tableInfo">
            <div id="classrooms">
                <table>
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Mã phòng</th>
                            <th>Mã độc giả</th>
                            <th>Yêu cầu</th>
                            <th>Trạng thái xử lý</th>
                            <th>Thông tin phiếu</th>
                        </tr>
                    </thead>
                    <tbody class="InfoClassrooms">
                        @{
                            var Database = new Library_Management.Models.QUANLYTHUVIENEntities();
                            var list = (from p in Database.PHONGHOCs
                                        join k in Database.DATPHONGs on p.MAPHONG equals k.MAPHONG
                                        join t in Database.THEBANDOCs on k.MASOTHE equals t.MASOTHE
                                        select new
                                        {
                                            maPhong = p.MAPHONG,
                                            maDocGia = t.MATHANHVIEN,
                                            yeuCau = k.YEUCAU,
                                            trangThai = k.TRANGTHAI
                                        }
                                ).ToList();
                            int stt = 1;
                            foreach (var item in list)
                            {
                                if (item.yeuCau != null)
                                {
                                    <tr>
                                        <td>@stt</td>
                                        <td>@item.maPhong</td>
                                        <td>@item.maDocGia</td>
                                        <td>@item.yeuCau</td>
                                        <td>@item.trangThai</td>
                                        <td>
                                            <button type="button" style="height:30px; width:80%" onclick="showInfoClassrooms()">Thông tin phiếu</button>
                                        </td>
                                    </tr>
                                    stt++;
                                }
                            }

                        }


                    </tbody>
                </table>
            </div>


        </div>
    </div>
    <script src="@Url.Content("~/wwwroot/JS/jquery-3.3.1.min.js")"></script>
    <script src="~/wwwroot/JS/DocumentsAndClassRooms.js">
    </script>
    <script src="~/wwwroot/JS/ReaderManagement.js"></script>
    <script>
$(document).ready(function () {
    $("#requestClassrooms").hide();

    $(".InfoClassrooms").on("click", "button", function (e) {
        e.stopPropagation();

        var $tr = $(this).closest("tr");
        var maPhong = $tr.find("td:eq(1)").text().trim();
        var maDocGia = $tr.find("td:eq(2)").text().trim();

        $.ajax({
            url: '@Url.Action("GetClassroomRequestInfo", "Management")',
            type: 'GET',
            data: {
                maPhong: maPhong,
                maDocGia: maDocGia
            },
            success: function (data) {
                if (data) {
                    $("#requestClassrooms input[name='code']").val(data.MaPhieu);
                    $("#requestClassrooms input[name='yeucau']").val(data.YeuCau);
                    $("#requestClassrooms input[name='madocgia']").val(data.MaDocGia);
                    $("#requestClassrooms input[name='maphong']").val(data.MaPhong);
                    $("#requestClassrooms input[name='tendocgia']").val(data.TenDocGia);
                    $("#requestClassrooms input[name='tenphong']").val(data.TenPhong);
                    $("#requestClassrooms input[name='vaitro']").val(data.VaiTro);
                    $("#requestClassrooms input[name='vitri']").val(data.ViTri);
                    $("#requestClassrooms input[name='khoa']").val(data.Khoa);
                    $("#requestClassrooms input[name='trangthaiphong']").val(data.TrangThai);
                    $("#requestClassrooms input[name='lop']").val(data.Lop);
                    $("#requestClassrooms input[name='solan']").val(data.SoLanGiaHan);
                    $("#requestClassrooms input[name='tgmuon']").val(data.ThoiGianMuon);
                    $("#requestClassrooms input[name='tgtra']").val(data.ThoiGianTra);

                    $("#requestClassrooms").show();
                } else {
                    alert("Không tìm thấy thông tin phiếu!");
                }
            },
            error: function () {
                alert("Lỗi khi lấy dữ liệu!");
            }
        });
    });
});
        function closeForm() {
            var form = document.getElementById("requestClassrooms");
            if (form) {
                form.style.display = "none";
            }
        }
        //Thời gian ẩn thông báo
        setTimeout(function () {
            var alert = document.getElementById('Notice');
            if (alert) {
                alert.style.display = 'none';
            }
        }, 3000);
    </script>

</body>
</html>

